<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Empleados</title>
    <script>
        const API_URL = 'backend_empleados.php'; // URL del backend PHP

        // Obtener todos los empleados
        async function getEmpleados() {
            const response = await fetch(API_URL);
            const empleados = await response.json();
            renderEmpleados(empleados);
        }

        // Renderizar empleados en la tabla
        function renderEmpleados(empleados) {
            const tableBody = document.querySelector('#empleadosTable tbody');
            tableBody.innerHTML = '';
            empleados.forEach(empleado => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${empleado.ID_EMPLEADO}</td>
                    <td>${empleado.NOMBRE}</td>
                    <td>${empleado.APELLIDO}</td>
                    <td>${empleado.TELEFONO || ''}</td>
                    <td>${empleado.ID_SUCURSAL}</td>
                    <td>
                        <button onclick="editarEmpleado(${empleado.ID_EMPLEADO})">Editar</button>
                        <button onclick="eliminarEmpleado(${empleado.ID_EMPLEADO})">Eliminar</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Crear o actualizar empleado
        async function guardarEmpleado() {
            const id = document.querySelector('#id_empleado').value;
            const nombre = document.querySelector('#nombre').value;
            const apellido = document.querySelector('#apellido').value;
            const telefono = document.querySelector('#telefono').value;
            const idSucursal = document.querySelector('#id_sucursal').value;

            const method = id ? 'PUT' : 'POST';
            const empleado = {
                ID_EMPLEADO: id,
                NOMBRE: nombre,
                APELLIDO: apellido,
                TELEFONO: telefono,
                ID_SUCURSAL: idSucursal
            };

            const response = await fetch(API_URL, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(empleado)
            });

            if (response.ok) {
                alert('Empleado guardado exitosamente');
                getEmpleados(); // Recargar empleados
                document.querySelector('#empleadoForm').reset(); // Limpiar formulario
            } else {
                alert('Error al guardar empleado');
            }
        }

        // Cargar datos de empleado en el formulario
        async function editarEmpleado(id) {
            const response = await fetch(${API_URL}?id=${id});
            const empleado = await response.json();

            if (empleado && empleado.ID_EMPLEADO) {
                document.querySelector('#id_empleado').value = empleado.ID_EMPLEADO;
                document.querySelector('#nombre').value = empleado.NOMBRE;
                document.querySelector('#apellido').value = empleado.APELLIDO;
                document.querySelector('#telefono').value = empleado.TELEFONO || '';
                document.querySelector('#id_sucursal').value = empleado.ID_SUCURSAL;
            } else {
                alert('Empleado no encontrado');
            }
        }

        // Eliminar empleado
        async function eliminarEmpleado(id) {
            if (confirm('¿Estás seguro de eliminar este empleado?')) {
                const response = await fetch(API_URL, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ID_EMPLEADO: id })
                });

                if (response.ok) {
                    alert('Empleado eliminado exitosamente');
                    getEmpleados(); // Recargar empleados
                } else {
                    alert('Error al eliminar empleado');
                }
            }
        }

        // Inicializar datos
        document.addEventListener('DOMContentLoaded', getEmpleados);
    </script>
</head>
<body>
    <h1>Gestión de Empleados</h1>

    <!-- Formulario para crear o actualizar empleado -->
    <form id="empleadoForm" onsubmit="guardarEmpleado(); return false;">
        <input type="hidden" id="id_empleado">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" required>
        <label for="apellido">Apellido:</label>
        <input type="text" id="apellido" required>
        <label for="telefono">Teléfono:</label>
        <input type="text" id="telefono">
        <label for="id_sucursal">ID Sucursal:</label>
        <input type="number" id="id_sucursal" required>
        <button type="submit">Guardar</button>
    </form>

    <!-- Tabla para mostrar empleados -->
    <h2>Empleados</h2>
    <table id="empleadosTable" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Teléfono</th>
                <th>ID Sucursal</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</body>
</html>